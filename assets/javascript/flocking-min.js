paper.install(window);let Boid=Base.extend({initialize:function(i,t,e){this.position=new Point(t,e),this.acceleration=new Point(0,0),this.id=i;this.r=10,this.maxSpeed=this.addNoise(3,.4);this.velocity=new Point(.25*this.maxSpeed*(1-2*Math.random()),.25*this.maxSpeed*(1-2*Math.random())),this.oldAngle=this.velocity.angle,this.maxForce=this.addNoise(.04,.4),this.maxRotation=.01,this.enforceMaximumRotation=!0,this.desiredSeparation=30,this.desiredSeparation*=this.desiredSeparation,this.alignmentNeighborDist=this.addNoise(50,.4),this.alignmentNeighborDist*=this.alignmentNeighborDist,this.cohesionNeighborDist=this.addNoise(200,.4),this.cohesionNeighborDist*=this.cohesionNeighborDist,this.separationWeight=2,this.alignmentWeight=this.addNoise(1,.4),this.cohesionWeight=this.addNoise(1.2,.4),this.avoidWeight=this.addNoise(.1,.4),this.avoidDistance=this.addNoise(100,.4),this.mass=this.addNoise(1,.4);let s=new Point(7,0),o=new Point(0,0),a=o.subtract(new Point(9,0));this.arrowOriginal=new Group([new Path([a,o]),new Path([o.add(s.rotate(135)),o,o.add(s.rotate(-135))])]),this.arrowOriginal.strokeWidth=1,this.arrowOriginal.strokeColor="#1C1A20",this.arrowOriginal.applyMatrix=!1,this.arrow=this.arrowOriginal.rasterize(),this.arrowOriginal.remove()},addNoise:function(i,t){return i*(1+t*(1-2*Math.random()))},run:function(i,t,e){this.flockStep(i,t,e),this.update(),this.borders(),this.render()},update:function(){if(this.velocity=this.velocity.add(this.acceleration),this.velocity.length>this.maxSpeed&&(this.velocity=this.velocity.normalize(this.maxSpeed)),this.enforceMaximumRotation){let i=this.velocity.angle,t=i-this.oldAngle;if(Math.abs(t)>this.maxRotation){let e=0;e=this.oldAngle+this.maxRotation*Math.sign(t),this.velocity.rotate(i-e),this.oldAngle=e}else this.oldAngle=i}this.position=this.position.add(this.velocity),this.acceleration=new Point(0,0)},seek:function(i){let t=i.subtract(this.position),e=(t=t.normalize(this.maxSpeed)).subtract(this.velocity);return e.length>this.maxForce&&(e=e.normalize(this.maxForce)),e},borders:function(){let i=view.viewSize.width,t=view.viewSize.height;this.position.x<-this.r&&(this.position.x=i+this.r),this.position.y<-this.r&&(this.position.y=t+this.r),this.position.x>i+this.r&&(this.position.x=-this.r),this.position.y>t+this.r&&(this.position.y=-this.r)},render:function(){this.arrow.position=this.position,this.arrow.rotate(this.velocity.angle-this.arrow.rotation)},flockStep:function(i,t,e){let s=new Point(0,0),o=new Point(0,0),a=new Point(0,0),n=new Point(0,0),h=0,r=new Point(0,0),d=0,l=new Point(0,0),c=0,m=i.length;for(let t=0;t<m;t++){let o=e[this.id][t];if(o>0&&o<this.desiredSeparation){let e=this.position.subtract(i[t].position);e=(e=e.normalize()).divide(o),s=s.add(e),h++}o>0&&o<this.alignmentNeighborDist&&(r=r.add(i[t].velocity),d++),o>0&&o<this.cohesionNeighborDist&&(l=l.add(i[t].position),c++)}h>0&&(s=(s=(s=(s=s.divide(h)).normalize()).multiply(this.maxSpeed)).subtract(this.velocity)).length>this.maxForce&&(s=s.normalize(this.maxForce)),d>0&&(o=(r=(r=r.divide(d)).normalize(this.maxSpeed)).subtract(this.velocity)).length>this.maxForce&&(o=o.normalize(this.maxForce)),c>0&&(l=l.divide(c),a=this.seek(l));let u=t.subtract(this.position),p=u.length;if(p<this.avoidDistance){let i=this.position.add(this.velocity);n=(n=(i=(i=i.normalize()).multiply(u.dot(i))).subtract(u).multiply(1-p/this.avoidDistance)).normalize()}s=s.multiply(this.separationWeight/this.mass),o=o.multiply(this.alignmentWeight/this.mass),a=a.multiply(this.cohesionWeight/this.mass),n=n.multiply(this.avoidWeight/this.mass),this.acceleration=this.acceleration.add(s),this.acceleration=this.acceleration.add(o),this.acceleration=this.acceleration.add(a),this.acceleration=this.acceleration.add(n)}}),Flock=Base.extend({initialize:function(){this.boids=[],this.l=0,this.currentMousePos=new Point,this.distances=[],this.frameCounter=0,this.frameSkip=2,this.frameSkip++,this.measurePerformance=!1,this.framesPerMeasurement=100,this.startTime=0,this.endTime=0,this.totalTime=0,this.performanceCounter=0},addBoid:function(i){this.l++,this.boids.push(i)},run:function(){if(this.measurePerformance&&(this.startTime=performance.now()),this.frameCounter%this.frameSkip==0){let i=0;for(let t=0;t<this.l;t++){this.distances[t]=[],this.distances[t][t]=0;for(let e=0;e<t;e++)i=this.boids[t].position.getDistance(this.boids[e].position,!0),this.distances[t][e]=i,this.distances[e][t]=i}}for(let i=0;i<this.l;i++)this.boids[i].run(this.boids,this.currentMousePos,this.distances);if(this.frameCounter++,this.measurePerformance&&(this.endTime=performance.now(),this.totalTime+=this.endTime-this.startTime,this.performanceCounter++,this.performanceCounter==this.framesPerMeasurement)){let i=1e3*this.framesPerMeasurement/60,t=Math.round(10*(100-(i-this.totalTime)/i*100))/10;console.log("Average time used over "+this.framesPerMeasurement+" frames: "+t+"%"),this.performanceCounter=0,this.totalTime=0}},updateMouse:function(i){this.currentMousePos=i}});function startPaper(){paper.setup("boid-canvas");flock=new Flock;for(let i=0;i<100;i++){const t=5;let e=view.viewSize.width+2*t,s=view.viewSize.height+2*t,o=0,a=0,n=Math.random();o=e*Math.min(1,Math.max(0,Math.abs((4*n-.5)%4-2)-.5))-t,a=s*Math.min(1,Math.max(0,Math.abs((4*n+.5)%4-2)-.5))-t;let h=new Boid(i,o,a);flock.addBoid(h)}view.onFrame=function(i){flock.run()},view.onMouseMove=function(i){flock.updateMouse(i.point)}}function addOnloadListener(i){window.addEventListener?window.addEventListener("load",i,!1):window.attachEvent?window.attachEvent("onload",i):window.onload=chain(window.onload,i)}addOnloadListener(startPaper);