"use strict";function startPaper(){paper.setup("canvas");flock=new Flock;for(var i=0;i<80;i++){var t=view.viewSize.width+10,s=view.viewSize.height+10,e=0,o=0,a=Math.random();e=t*Math.min(1,Math.max(0,Math.abs((4*a-.5)%4-2)-.5))-5,o=s*Math.min(1,Math.max(0,Math.abs((4*a+.5)%4-2)-.5))-5;var n=new Boid(i,e,o);flock.addBoid(n)}view.onFrame=function(){flock.run()},view.onMouseMove=function(i){flock.updateMouse(i.point)}}function addOnloadListener(i){window.addEventListener?window.addEventListener("load",i,!1):window.attachEvent?window.attachEvent("onload",i):window.onload=chain(window.onload,i)}var Boid=Base.extend({initialize:function(i,t,s){this.position=new Point(t,s),this.acceleration=new Point(0,0),this.id=i;this.r=10,this.maxSpeed=this.addNoise(1.6,.35);this.velocity=new Point(.25*this.maxSpeed*(1-2*Math.random()),.25*this.maxSpeed*(1-2*Math.random())),this.maxForce=this.addNoise(.04,.35),this.desiredSeparation=25,this.alignmentNeighborDist=this.addNoise(50,.35),this.cohesionNeighborDist=this.addNoise(200,.35),this.separationWeight=2,this.alignmentWeight=this.addNoise(1,.35),this.cohesionWeight=this.addNoise(1.2,.35),this.avoidWeight=this.addNoise(.1,.35),this.avoidDistance=this.addNoise(100,.35),this.mass=this.addNoise(1,.35);var e=new Point(6,0),o=new Point(0,0),a=o.subtract(new Point(6,0));this.arrow=new Group([new Path([a,o]),new Path([o.add(e.rotate(135)),o,o.add(e.rotate(-135))])]),this.arrow.strokeWidth=1,this.arrow.strokeColor="#1C1A20",this.arrow.applyMatrix=!1},addNoise:function(i,t){return i*(1+t*(1-2*Math.random()))},run:function(i,t,s){this.flock(i,t,s),this.update(),this.borders(),this.render()},update:function(){this.velocity=this.velocity.add(this.acceleration),this.velocity.length>this.maxSpeed&&(this.velocity=this.velocity.normalize(this.maxSpeed)),this.position=this.position.add(this.velocity),this.acceleration=new Point(0,0)},seek:function(i){var t=i.subtract(this.position);t=t.normalize(this.maxSpeed);var s=t.subtract(this.velocity);return s.length>this.maxForce&&(s=s.normalize(this.maxForce)),s},borders:function(){var i=view.viewSize.width,t=view.viewSize.height;this.position.x<-this.r&&(this.position.x=i+this.r),this.position.y<-this.r&&(this.position.y=t+this.r),this.position.x>i+this.r&&(this.position.x=-this.r),this.position.y>t+this.r&&(this.position.y=-this.r)},render:function(){this.arrow.position=this.position,this.arrow.rotate(this.velocity.angle-this.arrow.rotation)},flock:function(i,t,s){for(var e=new Point(0,0),o=new Point(0,0),a=new Point(0,0),n=new Point(0,0),h=0,r=new Point(0,0),d=0,c=new Point(0,0),l=0,p=i.length,u=0;u<p;u++){var v=s[this.id][u];if(v>0&&v<this.desiredSeparation){var m=this.position.subtract(i[u].position);m=m.normalize(),m=m.divide(v),e=e.add(m),h++}v>0&&v<this.alignmentNeighborDist&&(r=r.add(i[u].velocity),d++),v>0&&v<this.cohesionNeighborDist&&(c=c.add(i[u].position),l++)}h>0&&(e=e.divide(h),e=e.normalize(),e=e.multiply(this.maxSpeed),e=e.subtract(this.velocity),e.length>this.maxForce&&(e=e.normalize(this.maxForce))),d>0&&(r=r.divide(d),r=r.normalize(this.maxSpeed),o=r.subtract(this.velocity),o.length>this.maxForce&&(o=o.normalize(this.maxForce))),l>0&&(c=c.divide(l),a=this.seek(c));var w=t.subtract(this.position),f=w.length;if(f<this.avoidDistance){var g=this.position.add(this.velocity);g=g.normalize(),g=g.multiply(w.dot(g)),n=g.subtract(w).multiply(1-f/this.avoidDistance),n=n.normalize()}e=e.multiply(this.separationWeight/this.mass),o=o.multiply(this.alignmentWeight/this.mass),a=a.multiply(this.cohesionWeight/this.mass),n=n.multiply(this.avoidWeight/this.mass),this.acceleration=this.acceleration.add(e),this.acceleration=this.acceleration.add(o),this.acceleration=this.acceleration.add(a),this.acceleration=this.acceleration.add(n)}}),Flock=Base.extend({initialize:function(){this.boids=[],this.l=0,this.currentMousePos=new Point,this.distances=[]},addBoid:function(i){this.l++,this.boids.push(i)},run:function(){for(var i=0,t=0;t<this.l;t++){this.distances[t]=[],this.distances[t][t]=0;for(var s=0;s<t;s++)i=this.boids[t].position.getDistance(this.boids[s].position),this.distances[t][s]=i,this.distances[s][t]=i}for(var e=0;e<this.l;e++)this.boids[e].run(this.boids,this.currentMousePos,this.distances)},updateMouse:function(i){this.currentMousePos=i}});addOnloadListener(startPaper);